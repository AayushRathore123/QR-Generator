<div class="container py-4">
  <h2 class="mb-3">Saved QR Codes</h2>

  <div class="table-responsive">
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Type</th>
          <th>Details</th>
          <th>QR Code</th>
          <th>Saved On</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of qrcodes; let i = index">
          <td>
            <ng-container *ngIf="editIndex !== i; else editName">
              {{ data.name }}
            </ng-container>
            <ng-template #editName>
              <input [(ngModel)]="editedName" class="form-control form-control-sm" />
            </ng-template>
          </td>

          <td>
            <ng-container *ngIf="editIndex !== i; else editDesc">
              {{ data.description }}
            </ng-container>
            <ng-template #editDesc>
              <input [(ngModel)]="editedDescription" class="form-control form-control-sm" />
            </ng-template>
          </td>

          <td class="text-uppercase">{{ data.type }}</td>

          <td *ngIf="data.type === 'wifi'">
            <strong>SSID:</strong> {{ data.data.ssid }}<br />
            <strong>Auth type:</strong> {{ data.data.authType }}
          </td>

          <td *ngIf="data.type === 'link'">
            <strong>URL:</strong>
            <a [href]="data.data.url" target="_blank">
              {{ data.data.url | slice: 0: 40 }}
            </a>
          </td>

          <td>
            <qrcode [elementType]="'canvas'" [qrdata]="data.data.url || ('WIFI:S:' + data.data.ssid + ';T:' + data.data.authType + ';P:' + data.data.password + ';;')" #qrCanvas [width]="150"></qrcode>
          </td>

          <td>{{ data.saved_at | date: 'yyyy-MM-dd HH:mm' }}</td>

          <td class="text-center">
            <ng-container *ngIf="editIndex === i; else actions">
              <button class="btn btn-sm btn-success me-1" (click)="saveEdit(data)">
                <i class="fa-solid fa-check"></i>
              </button>
              <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </ng-container>
            <ng-template #actions>
              <button class="btn btn-sm btn-primary me-1" (click)="downloadQR(qrCanvas)">
                <i class="fa-solid fa-download"></i>
              </button>
              <button class="btn btn-sm btn-warning me-1" (click)="editRow(i)">
                <i class="fa-solid fa-pen-to-square"></i>
              </button>
              <button class="btn btn-sm btn-danger" (click)="confirmDelete(data)" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
